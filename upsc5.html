<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>UPSC Pro Tracker</title>
<style>
    :root {
        --primary: #4f46e5;
        --bg: #f3f4f6;
        --card: #ffffff;
        --text: #1f2937;
        --gray: #9ca3af;
        --red: #ef4444;
    }
    [data-theme="dark"] {
        --primary: #818cf8;
        --bg: #111827;
        --card: #1f2937;
        --text: #f3f4f6;
        --gray: #9ca3af;
    }
    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; user-select: none; }
    
    /* Header */
    .header { position: sticky; top: 0; background: var(--card); padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { margin: 0; font-size: 1.2rem; color: var(--primary); font-weight: 800; }
    .theme-btn { background: none; border: none; font-size: 1.4rem; cursor: pointer; }

    /* Sections */
    .container { padding: 15px; max-width: 600px; margin: 0 auto; }
    .section { display: none; animation: fadeIn 0.3s; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .card { background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.05); }
    h2 { font-size: 1.1rem; margin-top: 0; border-bottom: 2px solid var(--bg); padding-bottom: 10px; color: var(--text); }

    /* FULL CALENDAR STYLES */
    .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .cal-btn { background: var(--bg); border: none; padding: 5px 15px; border-radius: 8px; font-weight: bold; color: var(--primary); cursor: pointer; }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
    .cal-day-name { font-size: 0.8rem; color: var(--gray); font-weight: bold; padding-bottom: 5px; }
    .cal-date { 
        height: 40px; display: flex; align-items: center; justify-content: center; 
        border-radius: 50%; font-size: 0.9rem; cursor: pointer; position: relative;
        background: var(--bg); 
    }
    .cal-date.empty { background: transparent; cursor: default; }
    .cal-date.today { border: 2px solid var(--primary); font-weight: bold; }
    .cal-date.selected { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); }
    .has-task-dot {
        position: absolute; bottom: 4px; width: 4px; height: 4px; 
        background-color: var(--red); border-radius: 50%;
    }

    /* Tasks */
    .task-box { margin-top: 20px; border-top: 1px solid var(--bg); padding-top: 15px; }
    .task-input-row { display: flex; gap: 8px; margin-bottom: 15px; }
    .task-input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid var(--bg); background: var(--bg); color: var(--text); }
    .add-btn { background: var(--primary); color: white; border: none; padding: 0 20px; border-radius: 10px; font-weight: bold; font-size: 1.2rem; }
    
    .task-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); margin-bottom: 8px; border-radius: 10px; border-left: 4px solid var(--primary); }
    .task-item.done { opacity: 0.6; text-decoration: line-through; border-left-color: #10b981; }
    .del-btn { color: var(--red); font-weight: bold; padding: 5px 10px; }

    /* Dashboard & Syllabus */
    .circle-wrap { width: 130px; height: 130px; background: #e5e7eb; border-radius: 50%; margin: 20px auto; position: relative; display: flex; justify-content: center; align-items: center; }
    .circle-inner { width: 100px; height: 100px; background: var(--card); border-radius: 50%; position: absolute; display: flex; justify-content: center; align-items: center; font-weight: 800; font-size: 1.8rem; color: var(--primary); }
    
    .subject-row { padding: 12px; margin: 6px 0; background: var(--bg); border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; }
    .topic-list { display: none; padding: 10px 5px; }
    .topic-list.show { display: block; animation: fadeIn 0.3s; }
    .topic-item { display: flex; align-items: center; margin: 10px 0; font-size: 0.95rem; }
    input[type="checkbox"] { transform: scale(1.3); margin-right: 12px; accent-color: var(--primary); }

    /* Notes & Timer */
    .tabs { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; scrollbar-width: none; }
    .tab { padding: 8px 16px; background: var(--bg); border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 0.85rem; border: 1px solid transparent; }
    .tab.active { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2); }
    textarea { width: 100%; height: 60vh; padding: 15px; border-radius: 12px; border: none; background: var(--bg); color: var(--text); resize: none; font-size: 1rem; line-height: 1.6; }

    .timer-display { font-size: 4.5rem; text-align: center; font-weight: 800; margin: 40px 0; color: var(--text); font-variant-numeric: tabular-nums; letter-spacing: -2px; }
    .timer-controls { display: flex; justify-content: center; gap: 20px; }
    .t-btn { padding: 15px 40px; border-radius: 40px; border: none; font-size: 1.1rem; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .t-start { background: var(--primary); color: white; }
    .t-reset { background: var(--bg); color: var(--text); }

    /* Bottom Nav */
    .nav { position: fixed; bottom: 0; width: 100%; background: var(--card); border-top: 1px solid var(--bg); display: flex; justify-content: space-around; padding: 12px 0; z-index: 999; box-shadow: 0 -5px 15px rgba(0,0,0,0.03); }
    .nav-btn { background: none; border: none; color: var(--gray); display: flex; flex-direction: column; align-items: center; font-size: 0.7rem; gap: 5px; font-weight: 500; }
    .nav-btn.active { color: var(--primary); transform: translateY(-2px); }
    .nav-icon { font-size: 1.5rem; }

</style>
</head>
<body>

<div class="header">
    <h1>üöÄ UPSC Pro</h1>
    <button class="theme-btn" onclick="toggleTheme()" id="themeIcon">üåô</button>
</div>

<div class="container">

    <div id="home" class="section active">
        <div class="card">
            <h2>üìä Syllabus Completed</h2>
            <div class="circle-wrap" id="progressCircle">
                <div class="circle-inner" id="progressText">0%</div>
            </div>
        </div>
        <div class="card">
            <h2>üí° Daily Motivation</h2>
            <p style="font-style: italic; line-height: 1.6;">"It does not matter how slowly you go as long as you do not stop."</p>
        </div>
    </div>

    <div id="syllabus" class="section">
        <div class="card">
            <h2>üìö Syllabus Tracker</h2>
            <div id="syllabusList"></div>
        </div>
    </div>

    <div id="planner" class="section">
        <div class="card">
            <div class="cal-header">
                <button class="cal-btn" onclick="changeMonth(-1)">‚ùÆ Prev</button>
                <span id="monthYearDisplay" style="font-weight: 800; font-size: 1.1rem;"></span>
                <button class="cal-btn" onclick="changeMonth(1)">Next ‚ùØ</button>
            </div>
            
            <div class="cal-grid" style="margin-bottom: 10px;">
                <div class="cal-day-name">S</div><div class="cal-day-name">M</div>
                <div class="cal-day-name">T</div><div class="cal-day-name">W</div>
                <div class="cal-day-name">T</div><div class="cal-day-name">F</div>
                <div class="cal-day-name">S</div>
            </div>
            
            <div id="calendarGrid" class="cal-grid"></div>

            <div class="task-box">
                <p id="selectedDateLabel" style="font-weight: bold; margin-bottom: 10px; color: var(--primary);">Select a date</p>
                <div class="task-input-row">
                    <input type="text" id="taskInput" class="task-input" placeholder="Add task for this date...">
                    <button class="add-btn" onclick="addTask()">+</button>
                </div>
                <div id="taskList"></div>
            </div>
        </div>
    </div>

    <div id="notes" class="section">
        <div class="card">
            <h2>üìù Smart Notes</h2>
            <div class="tabs">
                <div class="tab active" onclick="setNoteTab('General', this)">General</div>
                <div class="tab" onclick="setNoteTab('History', this)">History</div>
                <div class="tab" onclick="setNoteTab('Polity', this)">Polity</div>
                <div class="tab" onclick="setNoteTab('Geography', this)">Geography</div>
                <div class="tab" onclick="setNoteTab('Gujarat', this)">Gujarat Spl</div>
            </div>
            <textarea id="noteArea" placeholder="Start typing here..." oninput="saveNote()"></textarea>
            <p id="saveMsg" style="text-align: right; color: #10b981; font-size: 0.8rem; opacity: 0;">Saved</p>
        </div>
    </div>

    <div id="timer" class="section">
        <div class="card" style="text-align: center;">
            <h2>‚è≥ Pomodoro Timer</h2>
            <div class="timer-display" id="timerDisplay">25:00</div>
            <div class="timer-controls">
                <button class="t-btn t-start" onclick="toggleTimer()" id="timerToggle">Start</button>
                <button class="t-btn t-reset" onclick="resetTimer()">Reset</button>
            </div>
        </div>
    </div>

</div>

<div class="nav">
    <button class="nav-btn active" onclick="switchTab('home', this)"><span class="nav-icon">üè†</span>Home</button>
    <button class="nav-btn" onclick="switchTab('syllabus', this)"><span class="nav-icon">üìö</span>Syllabus</button>
    <button class="nav-btn" onclick="switchTab('planner', this)"><span class="nav-icon">üóìÔ∏è</span>Planner</button>
    <button class="nav-btn" onclick="switchTab('notes', this)"><span class="nav-icon">üìù</span>Notes</button>
    <button class="nav-btn" onclick="switchTab('timer', this)"><span class="nav-icon">‚è≥</span>Timer</button>
</div>

<script>
    // --- APP STATE ---
    const syllabusData = {
        "History": ["Ancient India", "Medieval India", "Modern India", "Art & Culture", "World History"],
        "Polity": ["Preamble", "Fundamental Rights", "Parliament", "Supreme Court", "Governor", "Panchayati Raj"],
        "Geography": ["Physical Geography", "Climate of India", "Soils & Agriculture", "Resources", "World Mapping"],
        "Economy": ["National Income", "Banking & RBI", "Budget & Survey", "Inflation", "Schemes"],
        "Gujarat Special": ["Gujarat History", "Gujarat Geography", "Gujarat Art/Culture", "Gujarat Districts"]
    };

    let state = {
        today: new Date(),
        currMonth: new Date().getMonth(),
        currYear: new Date().getFullYear(),
        selectedDate: new Date().toISOString().split('T')[0], // YYYY-MM-DD
        noteTab: 'General',
        timerId: null,
        timeLeft: 1500,
        isRunning: false
    };

    // --- INIT ---
    window.onload = function() {
        // Load Theme
        if(localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
        
        // Initial Renders
        renderSyllabus();
        renderCalendar();
        loadTasks(); // Loads for today by default
        loadNote();
        updateSyllabusProgress();

        // Set Label
        updateDateLabel(state.selectedDate);
    };

    // --- NAVIGATION ---
    function switchTab(id, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    function toggleTheme() {
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    // --- SYLLABUS LOGIC ---
    function renderSyllabus() {
        const container = document.getElementById('syllabusList');
        const saved = JSON.parse(localStorage.getItem('upscSyllabus')) || {};
        
        let html = '';
        for(let subject in syllabusData) {
            let topicsHtml = '';
            syllabusData[subject].forEach(topic => {
                let id = subject + '-' + topic;
                let checked = saved[id] ? 'checked' : '';
                topicsHtml += `
                    <div class="topic-item">
                        <input type="checkbox" id="${id}" ${checked} onchange="toggleTopic('${id}')">
                        <label for="${id}">${topic}</label>
                    </div>`;
            });
            html += `
                <div class="subject-row" onclick="this.nextElementSibling.classList.toggle('show')">
                    ${subject} <span>‚ñº</span>
                </div>
                <div class="topic-list">${topicsHtml}</div>
            `;
        }
        container.innerHTML = html;
    }

    function toggleTopic(id) {
        let saved = JSON.parse(localStorage.getItem('upscSyllabus')) || {};
        if(document.getElementById(id).checked) saved[id] = true;
        else delete saved[id];
        localStorage.setItem('upscSyllabus', JSON.stringify(saved));
        updateSyllabusProgress();
    }

    function updateSyllabusProgress() {
        let saved = JSON.parse(localStorage.getItem('upscSyllabus')) || {};
        let total = Object.values(syllabusData).flat().length;
        let done = Object.keys(saved).length;
        let pct = Math.round((done/total)*100);
        
        document.getElementById('progressText').innerText = pct + '%';
        document.getElementById('progressCircle').style.background = `conic-gradient(var(--primary) ${pct}%, #e5e7eb 0)`;
    }

    // --- NEW FULL CALENDAR LOGIC ---
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const monthLabel = document.getElementById('monthYearDisplay');
        
        grid.innerHTML = '';
        
        // Month Names
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        monthLabel.innerText = `${monthNames[state.currMonth]} ${state.currYear}`;

        // Calculations
        const firstDay = new Date(state.currYear, state.currMonth, 1).getDay(); // 0-6 (Sun-Sat)
        const daysInMonth = new Date(state.currYear, state.currMonth + 1, 0).getDate(); // 28-31
        
        // Get Tasks for dots
        const allTasks = JSON.parse(localStorage.getItem('upscTasks')) || {};

        // Empty Slots for previous month
        for(let i=0; i<firstDay; i++) {
            let div = document.createElement('div');
            div.className = 'cal-date empty';
            grid.appendChild(div);
        }

        // Days
        for(let d=1; d<=daysInMonth; d++) {
            let dateStr = `${state.currYear}-${String(state.currMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            let div = document.createElement('div');
            div.className = 'cal-date';
            div.innerText = d;
            
            // Highlight Today
            let todayStr = new Date().toISOString().split('T')[0];
            if(dateStr === todayStr) div.classList.add('today');
            
            // Highlight Selected
            if(dateStr === state.selectedDate) div.classList.add('selected');

            // Add Dot if tasks exist
            if(allTasks[dateStr] && allTasks[dateStr].length > 0) {
                let dot = document.createElement('div');
                dot.className = 'has-task-dot';
                div.appendChild(dot);
            }

            div.onclick = () => selectDate(dateStr);
            grid.appendChild(div);
        }
    }

    function changeMonth(delta) {
        state.currMonth += delta;
        if(state.currMonth > 11) {
            state.currMonth = 0;
            state.currYear++;
        } else if(state.currMonth < 0) {
            state.currMonth = 11;
            state.currYear--;
        }
        renderCalendar();
    }

    function selectDate(dateStr) {
        state.selectedDate = dateStr;
        updateDateLabel(dateStr);
        renderCalendar(); // Re-render to update selection highlight
        loadTasks();
    }

    function updateDateLabel(dateStr) {
        const d = new Date(dateStr);
        document.getElementById('selectedDateLabel').innerText = d.toDateString();
    }

    // --- TASK LOGIC ---
    function loadTasks() {
        const allTasks = JSON.parse(localStorage.getItem('upscTasks')) || {};
        const tasks = allTasks[state.selectedDate] || [];
        const list = document.getElementById('taskList');
        list.innerHTML = '';

        if(tasks.length === 0) list.innerHTML = '<div style="text-align:center; color:var(--gray); font-size:0.9rem;">No tasks yet.</div>';

        tasks.forEach((t, i) => {
            list.innerHTML += `
                <div class="task-item ${t.done ? 'done' : ''}">
                    <span onclick="toggleTask(${i})">${t.text}</span>
                    <span class="del-btn" onclick="delTask(${i})">‚úï</span>
                </div>`;
        });
    }

    function addTask() {
        const input = document.getElementById('taskInput');
        const val = input.value.trim();
        if(!val) return;

        let allTasks = JSON.parse(localStorage.getItem('upscTasks')) || {};
        if(!allTasks[state.selectedDate]) allTasks[state.selectedDate] = [];
        
        allTasks[state.selectedDate].push({text: val, done: false});
        localStorage.setItem('upscTasks', JSON.stringify(allTasks));
        
        input.value = '';
        loadTasks();
        renderCalendar(); // Refresh dots
    }

    function toggleTask(idx) {
        let allTasks = JSON.parse(localStorage.getItem('upscTasks'));
        let t = allTasks[state.selectedDate][idx];
        t.done = !t.done;
        localStorage.setItem('upscTasks', JSON.stringify(allTasks));
        loadTasks();
    }

    function delTask(idx) {
        let allTasks = JSON.parse(localStorage.getItem('upscTasks'));
        allTasks[state.selectedDate].splice(idx, 1);
        localStorage.setItem('upscTasks', JSON.stringify(allTasks));
        loadTasks();
        renderCalendar(); // Refresh dots
    }

    // --- NOTES ---
    function setNoteTab(tab, btn) {
        state.noteTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        loadNote();
    }
    
    function loadNote() {
        let notes = JSON.parse(localStorage.getItem('upscNotes')) || {};
        document.getElementById('noteArea').value = notes[state.noteTab] || '';
    }

    function saveNote() {
        let val = document.getElementById('noteArea').value;
        let notes = JSON.parse(localStorage.getItem('upscNotes')) || {};
        notes[state.noteTab] = val;
        localStorage.setItem('upscNotes', JSON.stringify(notes));
        
        let msg = document.getElementById('saveMsg');
        msg.style.opacity = 1;
        setTimeout(() => msg.style.opacity = 0, 1500);
    }

    // --- TIMER ---
    function toggleTimer() {
        let btn = document.getElementById('timerToggle');
        if(state.isRunning) {
            clearInterval(state.timerId);
            state.isRunning = false;
            btn.innerText = "Start";
            btn.classList.remove('t-reset'); 
            btn.classList.add('t-start');
        } else {
            state.timerId = setInterval(() => {
                if(state.timeLeft > 0) {
                    state.timeLeft--;
                    let m = Math.floor(state.timeLeft/60).toString().padStart(2,'0');
                    let s = (state.timeLeft%60).toString().padStart(2,'0');
                    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
                } else {
                    resetTimer();
                    if("vibrate" in navigator) navigator.vibrate([200,100,200]);
                    alert("Time Up!");
                }
            }, 1000);
            state.isRunning = true;
            btn.innerText = "Pause";
            btn.classList.remove('t-start');
            btn.classList.add('t-reset');
        }
    }

    function resetTimer() {
        clearInterval(state.timerId);
        state.isRunning = false;
        state.timeLeft = 1500;
        document.getElementById('timerDisplay').innerText = "25:00";
        let btn = document.getElementById('timerToggle');
        btn.innerText = "Start";
        btn.classList.add('t-start');
        btn.classList.remove('t-reset');
    }

</script>
</body>
</html>
